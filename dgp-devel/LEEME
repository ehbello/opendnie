Adaptación de los drivers originales del DNIe publicados por la DGP
realizada por:

Martin Paljak: martin @ paljak . pri . ee 
Juan Antonio Martínez jonsito @ terra . es

NOTAS sobre el driver DNIe para la versión 0.12.x de OpenSC:
----------------------------------------------------------------

Debido a los cambios en la versión 0.12.x de OpenSC los diversos drivers
de tarjetas ya no pueden ser compilados de manera independiente, sino
que se deben compilar de manera conjunta con la aplicación OpenSC

Para ello es preciso integrar el fuente del driver dentro de la
aplicación y compilar según las instrucciones que se adjuntan

El directorio dgp-devel contiene una versión corregida y adaptada del 
driver para el DNI electrónico derivada de la original publicada por 
la Dirección General de la Policía; preparada para su integración
con OpenSC 0.12. No se incluyen funcionalidades extras

INSTRUCCIONES DE INTALACION Y COMPILACION
---------------------------------------------------
0 - Requisitos previos

- Tener un sistema Linux con el entorno de desarrollo C instalado

- Tener instalados los paquetes (los nombres pueden variar en
función de la distribución):

* build-essential / pkgconfig / autoconf / automake / docbook-xsl
* subversion
* pcsc-lite / pcscd
* pcsc-lite-devel / libpcsclite-dev
* pcsc-tools
* readline
* readline-devel
* openct-devel (recomendable)
* openssl
* openssl-devel / libssl-dev / libglobus-openssl-dev
* libtool
* libtool-ltdl-devel
* libccid 
* libassuan
* libassuan-devel

1 - Crear un directorio de trabajo

bash$ mkdir workspace
bash$ cd workspace

2- Descargar la última versión de OpenSC del repositorio oficial:

bash$ svn co http://www.opensc-project.org/svn/opensc/trunk opensc

3- Descargar el código del repositorio de Cenatic

bash$ svn checkout https://svn.forge.morfeo-project.org/opendnie/dgp-devel

4- Incluir el directorio dnie en el arbol OpenSC

bash$ cp -r dgp-devel/src/libopensc/dnie opensc/src/libopensc

5- Parchear el código original con el fichero patch que se adjunta

bash$ cd opensc
bash$ patch -d . -p0 < ../dgp-devel/opensc-0.12.x-dnie.patch

6- Compilar e instalar

bash$ ./bootstrap
bash$ ./configure
bash$ make
bash$ sudo make install

7- Esta versión no genera un fichero /usr/lib/libopensc-dnie.so, sino que
el driver DNIe está integrado dentro de /usr/lib/libopensc.so

8- Una vez instalada, será necesario instalar los certificados de la DGP,
módulo pkcs#11 en Firefox/Mozilla, etc siguiendo los procedimientos
habituales descritos en la Web http://www.dnielectronico.es

