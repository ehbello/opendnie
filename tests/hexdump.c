/**
 * Programa para convertir un fichero binario
 * en un volcado hexadecimal + ascii
 *
 * Uso: hex2bin <file.hex >file.bin
 */
#include <stdio.h>
#include <unistd.h>
#include <string.h>
#include <stdlib.h>
#include <ctype.h>

#define MIN(a,b) ( ( (a) < (b) ) ? (a) : (b) )

static char test_data[] = {
    0xEA, 0xDE, 0xDA, 0x45, 0x53, 0x32, 0x94, 0x50, 0x39, 0xDA, 0xA4, 0x04,
    0xC8, 0xEB, 0xC4, 0xD3, 0xB7, 0xF5, 0xDC, 0x86, 0x92, 0x83, 0xCD, 0xEA,
    0x2F, 0x10, 0x1E, 0x2A, 0xB5, 0x4F, 0xB0, 0xD0, 0xB0, 0x3D, 0x8F, 0x03,
    0x0D, 0xAF, 0x24, 0x58, 0x02, 0x82, 0x88, 0xF5, 0x4C, 0xE5, 0x52, 0xF8,
    0xFA, 0x57, 0xAB, 0x2F, 0xB1, 0x03, 0xB1, 0x12, 0x42, 0x7E, 0x11, 0x13,
    0x1D, 0x1D, 0x27, 0xE1, 0x0A, 0x5B, 0x50, 0x0E, 0xAA, 0xE5, 0xD9, 0x40,
    0x30, 0x1E, 0x30, 0xEB, 0x26, 0xC3, 0xE9, 0x06, 0x6B, 0x25, 0x71, 0x56,
    0xED, 0x63, 0x9D, 0x70, 0xCC, 0xC0, 0x90, 0xB8, 0x63, 0xAF, 0xBB, 0x3B,
    0xFE, 0xD8, 0xC1, 0x7B, 0xE7, 0x67, 0x30, 0x34, 0xB9, 0x82, 0x3E, 0x97,
    0x7E, 0xD6, 0x57, 0x25, 0x29, 0x27, 0xF9, 0x57, 0x5B, 0x9F, 0xFF, 0x66,
    0x91, 0xDB, 0x64
};

char * dump(char *buf, size_t len) {
   int j;
   int count=0;
   static char res[16384];
   memset(res,0,sizeof(res));
   len= MIN(len,sizeof(res));
   for (count=0;count<len;count+=16) {
      int nitems = MIN( 16 , len-count );
      for ( j=0 ; j<nitems ; j++ ) 
          sprintf(res,"%s%02X ",res,0xff & *(buf+count+j));
      for ( ;     j<16     ; j++ ) 
          sprintf(res,"%s   ",res);
      for ( j=0 ; j<nitems ; j++ ) {
          char c = *(buf+count+j);
          sprintf(res,"%s%c",res,(isprint(c)?c:'.'));
      }
      for ( ;     j<16     ; j++ ) sprintf(res,"%s ",res);
      sprintf(res,"%s\n",res);
   }
   return res;
}

int main(int argc,char *argv[]) {
    printf("%s",dump(test_data,sizeof(test_data)));
    return 0;
}

